/**
 * LAS - Local Auto Save Plugin
 * localautosave/plugin.min.js
 *
 * Released under The MIT License (MIT)
 *
 * License: http://creativecommons.org/licenses/by/3.0/
 * Plugin info: http://valtlfelipe.github.io/TinyMCE-LocalAutoSave/
 * Author: Felipe Valtl de Mello
 *
 * Version: 0.4 released 28/02/2015
 *
 *
 * Modified by Diego Valerio Camarda
 * https://github.com/dvcama/TinyMCE-LocalAutoSave
 *
 */
tinymce.PluginManager.requireLangPack("localautosave"),tinymce.PluginManager.add("localautosave",function(t,e){function n(t){return t.replace(/[\x00-\x1f]+|&nbsp;|&#160;/gi," ").replace(/(.)\1{5,}|[%&;=<]/g,function(t){return t.length>1?"%0"+t.charAt(0)+t.length.toString()+"%":L[t]})}function o(t){return t.replace(/%[1-5]|%0(.)(\d+)%/g,function(t,e,n){var o,a,r;if(2==t.length)return U[t];for(o=[],a=0,r=parseInt(n);r>a;a++)o.push(e);return o.join("")})}function r(t){return t.replace(/,/g,"&#44;")}function i(t){return t.replace(/&#44;/g,",")}function c(){var t=[];if(E)for(var e=0,n=E.length;n>e;e++){var o=E.key([e]);0==o.indexOf(P.keyName+M)&&t.push(E.getItem(o))}return t.sort(),t.reverse()}function l(t){var e=[];if(E)for(var n=0,o=E.length;o>n;n++){var a=E.key([n]);0==a.indexOf(P.keyName+M)&&e.push(a)}if(e.sort(function(t,e){return E.getItem(t)>E.getItem(e)}),e.reverse(),t>0){var r=e;if(e=[],t<r.length)for(var n=t,o=r.length;o>n;n++)e.push(r[n])}return e}function s(t){if(E)for(var e=0,n=t.length;n>e;e++)E.removeItem(t[e])}function u(){{var e=null;t.editorManager.is}t.getContent().replace(/<\/?[a-z]+[^>]*>/gi,"").length>0&&K(),O=!0;try{if(E){var n=c();if(0===n.length)t.windowManager.alert("localautosave.noContent");else if(1===n.length&&0===t.getContent().replace(/\s|&nbsp;|<\/?p[^>]*>|<br[^>]*>/gi,"").length)t.setContent(i(n[0].substring(n[0].indexOf(",")+1))),O=!1;else{for(var a="<div class='localautosave_cnt' id=\""+M+"-popup-localautosave\"><ul id='localautosave_list'>",r=0,u=n.length;u>r;r++){var f=i(n[r].substring(n[r].indexOf(",")+1)),g=n[r].substring(0,n[r].indexOf(","));a+="<li class='clearfix'><label>"+g+"</label> <tt>("+f.replace(/<\/?[a-z]+[^>]*>/gi,"").length+" "+tinymce.translate("localautosave.chars")+")</tt><span>"+f+"</span></li>"}a+="</ul></div>",t.windowManager.open({width:380,height:240,scrollbars:!0,title:"localautosave.chooseVersion",html:a,buttons:[{text:"localautosave.clearAll",onclick:function(){s(l()),tinyMCE.activeEditor.windowManager.close()}},{text:"Cancel",onclick:"close"}]});var v=$("#"+M+"-popup-localautosave").find("li");$(".localautosave_cnt:first").height($(".localautosave_cnt:first").parent().height()-40),v.click(function(){tinyMCE.activeEditor.setContent($(this).children("span").html()),tinyMCE.activeEditor.windowManager.close()})}}else m=D.exec(document.cookie),m&&(e=o(m[1]))}catch(h){console.log(h),O=!1}}function f(e,n){var o=t,a=o.buttons,r=o.theme.panel.find("toolbar *"),i="undefined";if(typeof a[e]===i)return!1;var c=a[e],l=!1,s=0;return tinymce.each(c,function(){s++}),tinymce.each(r,function(t){if("button"==t.type&&typeof t.settings!==i){var e=0;if(tinymce.each(t.settings,function(t,n){c[n]==t&&e++}),e==s)return l=t,0!=n&&(l=t.getEl()),!1}}),l}function g(){var t=".mce-container .localautosave_cnt , .mce-container * .localautosave_cnt , .mce-widget .localautosave_cnt , .mce-widget * .localautosave_cnt {padding:20px;overflow: auto;} ";t+="#localautosave_list li {list-style:none;cursor:pointer;line-height:30px;border-bottom:1px solid #ddd;} ",t+="#localautosave_list li:hover {background-color:#ddd;} ",t+="#localautosave_list li span{display:none;} ",t+="#localautosave_list li tt{float:right;line-height: 30px;} ",t+="#localautosave_list li label{float:left;line-height: 30px;} ",t+='#localautosave_list .clearfix:before, #localautosave_list .clearfix:after { display: table; content: " "; } #localautosave_list .clearfix:after { clear: both; }',$("head").append("<style type='text/css'>"+t+"</style>")}function v(t,e){var n=t[0],o=t[1],a=t[2],r=t[3];n=d(n,o,a,r,e[0],7,-680876936),r=d(r,n,o,a,e[1],12,-389564586),a=d(a,r,n,o,e[2],17,606105819),o=d(o,a,r,n,e[3],22,-1044525330),n=d(n,o,a,r,e[4],7,-176418897),r=d(r,n,o,a,e[5],12,1200080426),a=d(a,r,n,o,e[6],17,-1473231341),o=d(o,a,r,n,e[7],22,-45705983),n=d(n,o,a,r,e[8],7,1770035416),r=d(r,n,o,a,e[9],12,-1958414417),a=d(a,r,n,o,e[10],17,-42063),o=d(o,a,r,n,e[11],22,-1990404162),n=d(n,o,a,r,e[12],7,1804603682),r=d(r,n,o,a,e[13],12,-40341101),a=d(a,r,n,o,e[14],17,-1502002290),o=d(o,a,r,n,e[15],22,1236535329),n=p(n,o,a,r,e[1],5,-165796510),r=p(r,n,o,a,e[6],9,-1069501632),a=p(a,r,n,o,e[11],14,643717713),o=p(o,a,r,n,e[0],20,-373897302),n=p(n,o,a,r,e[5],5,-701558691),r=p(r,n,o,a,e[10],9,38016083),a=p(a,r,n,o,e[15],14,-660478335),o=p(o,a,r,n,e[4],20,-405537848),n=p(n,o,a,r,e[9],5,568446438),r=p(r,n,o,a,e[14],9,-1019803690),a=p(a,r,n,o,e[3],14,-187363961),o=p(o,a,r,n,e[8],20,1163531501),n=p(n,o,a,r,e[13],5,-1444681467),r=p(r,n,o,a,e[2],9,-51403784),a=p(a,r,n,o,e[7],14,1735328473),o=p(o,a,r,n,e[12],20,-1926607734),n=y(n,o,a,r,e[5],4,-378558),r=y(r,n,o,a,e[8],11,-2022574463),a=y(a,r,n,o,e[11],16,1839030562),o=y(o,a,r,n,e[14],23,-35309556),n=y(n,o,a,r,e[1],4,-1530992060),r=y(r,n,o,a,e[4],11,1272893353),a=y(a,r,n,o,e[7],16,-155497632),o=y(o,a,r,n,e[10],23,-1094730640),n=y(n,o,a,r,e[13],4,681279174),r=y(r,n,o,a,e[0],11,-358537222),a=y(a,r,n,o,e[3],16,-722521979),o=y(o,a,r,n,e[6],23,76029189),n=y(n,o,a,r,e[9],4,-640364487),r=y(r,n,o,a,e[12],11,-421815835),a=y(a,r,n,o,e[15],16,530742520),o=y(o,a,r,n,e[2],23,-995338651),n=C(n,o,a,r,e[0],6,-198630844),r=C(r,n,o,a,e[7],10,1126891415),a=C(a,r,n,o,e[14],15,-1416354905),o=C(o,a,r,n,e[5],21,-57434055),n=C(n,o,a,r,e[12],6,1700485571),r=C(r,n,o,a,e[3],10,-1894986606),a=C(a,r,n,o,e[10],15,-1051523),o=C(o,a,r,n,e[1],21,-2054922799),n=C(n,o,a,r,e[8],6,1873313359),r=C(r,n,o,a,e[15],10,-30611744),a=C(a,r,n,o,e[6],15,-1560198380),o=C(o,a,r,n,e[13],21,1309151649),n=C(n,o,a,r,e[4],6,-145523070),r=C(r,n,o,a,e[11],10,-1120210379),a=C(a,r,n,o,e[2],15,718787259),o=C(o,a,r,n,e[9],21,-343485551),t[0]=A(n,t[0]),t[1]=A(o,t[1]),t[2]=A(a,t[2]),t[3]=A(r,t[3])}function h(t,e,n,o,a,r){return e=A(A(e,t),A(o,r)),A(e<<a|e>>>32-a,n)}function d(t,e,n,o,a,r,i){return h(e&n|~e&o,t,e,a,r,i)}function p(t,e,n,o,a,r,i){return h(e&o|n&~o,t,e,a,r,i)}function y(t,e,n,o,a,r,i){return h(e^n^o,t,e,a,r,i)}function C(t,e,n,o,a,r,i){return h(n^(e|~o),t,e,a,r,i)}function x(t){txt="";var e,n=t.length,o=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)v(o,k(t.substring(e-64,e)));t=t.substring(e-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)a[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(v(o,a),e=0;16>e;e++)a[e]=0;return a[14]=8*n,v(o,a),o}function k(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function w(t){for(var e="",n=0;4>n;n++)e+=z[t>>8*n+4&15]+z[t>>8*n&15];return e}function S(t){for(var e=0;e<t.length;e++)t[e]=w(t[e]);return t.join("")}function _(t){return S(x(t))}function A(t,e){return t+e&4294967295}function A(t,e){var n=(65535&t)+(65535&e),o=(t>>16)+(e>>16)+(n>>16);return o<<16|65535&n}function v(t,e){var n=t[0],o=t[1],a=t[2],r=t[3];n=d(n,o,a,r,e[0],7,-680876936),r=d(r,n,o,a,e[1],12,-389564586),a=d(a,r,n,o,e[2],17,606105819),o=d(o,a,r,n,e[3],22,-1044525330),n=d(n,o,a,r,e[4],7,-176418897),r=d(r,n,o,a,e[5],12,1200080426),a=d(a,r,n,o,e[6],17,-1473231341),o=d(o,a,r,n,e[7],22,-45705983),n=d(n,o,a,r,e[8],7,1770035416),r=d(r,n,o,a,e[9],12,-1958414417),a=d(a,r,n,o,e[10],17,-42063),o=d(o,a,r,n,e[11],22,-1990404162),n=d(n,o,a,r,e[12],7,1804603682),r=d(r,n,o,a,e[13],12,-40341101),a=d(a,r,n,o,e[14],17,-1502002290),o=d(o,a,r,n,e[15],22,1236535329),n=p(n,o,a,r,e[1],5,-165796510),r=p(r,n,o,a,e[6],9,-1069501632),a=p(a,r,n,o,e[11],14,643717713),o=p(o,a,r,n,e[0],20,-373897302),n=p(n,o,a,r,e[5],5,-701558691),r=p(r,n,o,a,e[10],9,38016083),a=p(a,r,n,o,e[15],14,-660478335),o=p(o,a,r,n,e[4],20,-405537848),n=p(n,o,a,r,e[9],5,568446438),r=p(r,n,o,a,e[14],9,-1019803690),a=p(a,r,n,o,e[3],14,-187363961),o=p(o,a,r,n,e[8],20,1163531501),n=p(n,o,a,r,e[13],5,-1444681467),r=p(r,n,o,a,e[2],9,-51403784),a=p(a,r,n,o,e[7],14,1735328473),o=p(o,a,r,n,e[12],20,-1926607734),n=y(n,o,a,r,e[5],4,-378558),r=y(r,n,o,a,e[8],11,-2022574463),a=y(a,r,n,o,e[11],16,1839030562),o=y(o,a,r,n,e[14],23,-35309556),n=y(n,o,a,r,e[1],4,-1530992060),r=y(r,n,o,a,e[4],11,1272893353),a=y(a,r,n,o,e[7],16,-155497632),o=y(o,a,r,n,e[10],23,-1094730640),n=y(n,o,a,r,e[13],4,681279174),r=y(r,n,o,a,e[0],11,-358537222),a=y(a,r,n,o,e[3],16,-722521979),o=y(o,a,r,n,e[6],23,76029189),n=y(n,o,a,r,e[9],4,-640364487),r=y(r,n,o,a,e[12],11,-421815835),a=y(a,r,n,o,e[15],16,530742520),o=y(o,a,r,n,e[2],23,-995338651),n=C(n,o,a,r,e[0],6,-198630844),r=C(r,n,o,a,e[7],10,1126891415),a=C(a,r,n,o,e[14],15,-1416354905),o=C(o,a,r,n,e[5],21,-57434055),n=C(n,o,a,r,e[12],6,1700485571),r=C(r,n,o,a,e[3],10,-1894986606),a=C(a,r,n,o,e[10],15,-1051523),o=C(o,a,r,n,e[1],21,-2054922799),n=C(n,o,a,r,e[8],6,1873313359),r=C(r,n,o,a,e[15],10,-30611744),a=C(a,r,n,o,e[6],15,-1560198380),o=C(o,a,r,n,e[13],21,1309151649),n=C(n,o,a,r,e[4],6,-145523070),r=C(r,n,o,a,e[11],10,-1120210379),a=C(a,r,n,o,e[2],15,718787259),o=C(o,a,r,n,e[9],21,-343485551),t[0]=A(n,t[0]),t[1]=A(o,t[1]),t[2]=A(a,t[2]),t[3]=A(r,t[3])}function h(t,e,n,o,a,r){return e=A(A(e,t),A(o,r)),A(e<<a|e>>>32-a,n)}function d(t,e,n,o,a,r,i){return h(e&n|~e&o,t,e,a,r,i)}function p(t,e,n,o,a,r,i){return h(e&o|n&~o,t,e,a,r,i)}function y(t,e,n,o,a,r,i){return h(e^n^o,t,e,a,r,i)}function C(t,e,n,o,a,r,i){return h(n^(e|~o),t,e,a,r,i)}function x(t){txt="";var e,n=t.length,o=[1732584193,-271733879,-1732584194,271733878];for(e=64;e<=t.length;e+=64)v(o,k(t.substring(e-64,e)));t=t.substring(e-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<t.length;e++)a[e>>2]|=t.charCodeAt(e)<<(e%4<<3);if(a[e>>2]|=128<<(e%4<<3),e>55)for(v(o,a),e=0;16>e;e++)a[e]=0;return a[14]=8*n,v(o,a),o}function k(t){var e,n=[];for(e=0;64>e;e+=4)n[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return n}function w(t){for(var e="",n=0;4>n;n++)e+=z[t>>8*n+4&15]+z[t>>8*n&15];return e}function S(t){for(var e=0;e<t.length;e++)t[e]=w(t[e]);return t.join("")}function _(t){return S(x(t))}function A(t,e){return t+e&4294967295}function A(t,e){var n=(65535&t)+(65535&e),o=(t>>16)+(e>>16)+(n>>16);return o<<16|65535&n}var T=($(t.formElement),!1),I=!1,M=t.id,O=!1,E=localStorage,j=null,L={"%":"%1","&":"%2",";":"%3","=":"%4","<":"%5"},U={"%1":"%","%2":"&","%3":";","%4":"=","%5":"<"},P={seconds:t.getParam("las_seconds")||6,keyName:t.getParam("las_keyName")||"LocalAutoSave",callback:t.getParam("las_callback"),versions:t.getParam("las_nVersions")||15},D=new RegExp("(?:^|;\\s*)"+P.keyName+M+"=([^;]*)(?:;|$)","i");g();try{E.setItem("LASTest","OK"),"OK"===E.getItem("LASTest")&&(E.removeItem("LASTest"),T=!0)}catch(N){try{E=sessionStorage,E.setItem("LASTest","OK"),"OK"===E.getItem("LASTest")&&(E.removeItem("LASTest"),I=!0)}catch(N){E=null}}Date.prototype.toISOString||!function(){function t(t){var e=String(t);return 1===e.length&&(e="0"+e),e}Date.prototype.toISOString=function(){return this.getUTCFullYear()+"-"+t(this.getUTCMonth()+1)+"-"+t(this.getUTCDate())+"T"+t(this.getUTCHours())+":"+t(this.getUTCMinutes())+":"+t(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}}();var K=(t.addButton("localautosave",{text:"",icon:"restoredraft",tooltip:"localautosave.restoreContent",onclick:function(){for(K();!O;)u()}}),function(){if(!O&&t.isDirty()){O=!0,content=t.getContent(),is=t.editorManager.is;var o=!1;if(is(content,"string")&&content.length>0){now=new Date,exp=new Date(now.getTime()+12e5);var i=P.keyName+M;if(P.versions>0&&(i+=_(content)),0===P.versions||j!=i){try{E?E.getItem(i)||E.setItem(i,now.toISOString().replace(/T/g," ").replace(/\.[0-9]*Z$/g,"")+","+r(content)):(a=i+"=",b="; expires="+exp.toUTCString(),document.cookie=a+n(content).slice(0,4096-a.length-b.length)+b),o=!0}catch(c){console.log(c)}if(o){obj=new Object,obj.content=content,obj.time=now.getTime(),P.callback&&P.callback.call(obj);var u=f("localautosave");$(u).find("i").replaceWith('<i class="mce-ico mce-i-none" style="background: url(\''+e+"/img/progress.gif') no-repeat;\"></i>");{setTimeout(function(){$(u).find("i").replaceWith('<i class="mce-ico mce-i-restoredraft fa-spin"></i>')},2e3)}}}o&&(j=i),P.versions>0&&s(l(P.versions))}}O=!1}),z=(setInterval(K,1e3*P.seconds),"0123456789abcdef".split(""));"5d41402abc4b2a76b9719d911017c592"!=_("hello");var z="0123456789abcdef".split("");"5d41402abc4b2a76b9719d911017c592"!=_("hello")});